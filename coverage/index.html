<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Type balancer-rails</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.13.1/application.js' type='text/javascript'></script>
    <link href='./assets/0.13.1/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="icon" type="image/png" href="./assets/0.13.1/favicon_red.png" />
  </head>

  <body data-branch-coverage=true>
    <div id="loading">
      <img src="./assets/0.13.1/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
      <div class="timestamp">Generated <abbr class="timeago" title="2025-04-12T17:35:09-04:00">2025-04-12T17:35:09-04:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="red">
  48.27%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.66
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
    <b>27</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>810</b> relevant lines,
    <span class="green"><b>391</b> lines covered</span> and
    <span class="red"><b>419</b> lines missed. </span>
    (<span class="red">
  48.27%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>137</b> total branches, </span>
      <span class="green"><b>7</b> branches covered</span> and
      <span class="red"><b>130</b> branches missed.</span>
      (<span class="red">
  5.11%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5e8bf8df465eb88974842831147ca256a7322512" class="src_link" title="lib/type_balancer/rails.rb">lib/type_balancer/rails.rb</a></td>
            <td class="red strong cell--number t-file__coverage">62.50 %</td>
            <td class="cell--number">103</td>
            <td class="cell--number">64</td>
            <td class="cell--number">40</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0.63</td>
            
              <td class="red strong cell--number t-file__branch-coverage">12.50 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">1</td>
              <td class="cell--number">7</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c681e27e96c00fdbf43647ec08660ab23a6713e5" class="src_link" title="lib/type_balancer/rails/balance_calculation_job.rb">lib/type_balancer/rails/balance_calculation_job.rb</a></td>
            <td class="red strong cell--number t-file__coverage">37.04 %</td>
            <td class="cell--number">57</td>
            <td class="cell--number">27</td>
            <td class="cell--number">10</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0.37</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5d37d84a60cc36b2d9ee6085bc052131239c20b9" class="src_link" title="lib/type_balancer/rails/balanced_collection_query.rb">lib/type_balancer/rails/balanced_collection_query.rb</a></td>
            <td class="red strong cell--number t-file__coverage">34.04 %</td>
            <td class="cell--number">104</td>
            <td class="cell--number">47</td>
            <td class="cell--number">16</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0.34</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6288559a1a2fb19a5e118e5129fab92a902cde7d" class="src_link" title="lib/type_balancer/rails/balanced_position.rb">lib/type_balancer/rails/balanced_position.rb</a></td>
            <td class="red strong cell--number t-file__coverage">63.64 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">22</td>
            <td class="cell--number">14</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.64</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#45e4ba3844f798c613fa07b7e3a2b4e2ac5456e0" class="src_link" title="lib/type_balancer/rails/cache_invalidation.rb">lib/type_balancer/rails/cache_invalidation.rb</a></td>
            <td class="red strong cell--number t-file__coverage">80.00 %</td>
            <td class="cell--number">26</td>
            <td class="cell--number">10</td>
            <td class="cell--number">8</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.80</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#43eb50c5f1a1f1f4f272c4c24b5af82cf3205e51" class="src_link" title="lib/type_balancer/rails/configuration.rb">lib/type_balancer/rails/configuration.rb</a></td>
            <td class="red strong cell--number t-file__coverage">47.17 %</td>
            <td class="cell--number">105</td>
            <td class="cell--number">53</td>
            <td class="cell--number">25</td>
            <td class="cell--number">28</td>
            <td class="cell--number">0.47</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#38eed2f5f4a7fa08315034825651e4c079c4a632" class="src_link" title="lib/type_balancer/rails/configuration/cache_config.rb">lib/type_balancer/rails/configuration/cache_config.rb</a></td>
            <td class="red strong cell--number t-file__coverage">44.00 %</td>
            <td class="cell--number">45</td>
            <td class="cell--number">25</td>
            <td class="cell--number">11</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0.44</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#bc14be6bf640a0785effb864a2ffa0f104f45296" class="src_link" title="lib/type_balancer/rails/configuration/pagination_config.rb">lib/type_balancer/rails/configuration/pagination_config.rb</a></td>
            <td class="red strong cell--number t-file__coverage">47.37 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">19</td>
            <td class="cell--number">9</td>
            <td class="cell--number">10</td>
            <td class="cell--number">0.47</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2707f93a73ba0812f4ee473d66c7f7be6f25e234" class="src_link" title="lib/type_balancer/rails/configuration/redis_config.rb">lib/type_balancer/rails/configuration/redis_config.rb</a></td>
            <td class="red strong cell--number t-file__coverage">40.74 %</td>
            <td class="cell--number">46</td>
            <td class="cell--number">27</td>
            <td class="cell--number">11</td>
            <td class="cell--number">16</td>
            <td class="cell--number">0.41</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#826fd4e7903fad47f932ff722f5955bfbbda748c" class="src_link" title="lib/type_balancer/rails/configuration/storage_strategy_registry.rb">lib/type_balancer/rails/configuration/storage_strategy_registry.rb</a></td>
            <td class="red strong cell--number t-file__coverage">56.25 %</td>
            <td class="cell--number">33</td>
            <td class="cell--number">16</td>
            <td class="cell--number">9</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0.56</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7e3aaf4adbd5843c96c549c400036700b7abd871" class="src_link" title="lib/type_balancer/rails/container.rb">lib/type_balancer/rails/container.rb</a></td>
            <td class="red strong cell--number t-file__coverage">45.45 %</td>
            <td class="cell--number">49</td>
            <td class="cell--number">22</td>
            <td class="cell--number">10</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0.45</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#be8775049c93fa54a1c70683f77d3d07e9a6f2a5" class="src_link" title="lib/type_balancer/rails/core.rb">lib/type_balancer/rails/core.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">59</td>
            <td class="cell--number">32</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5.47</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0ef718a947790cf19351a6ad73609bd6143edf55" class="src_link" title="lib/type_balancer/rails/query.rb">lib/type_balancer/rails/query.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.89 %</td>
            <td class="cell--number">18</td>
            <td class="cell--number">9</td>
            <td class="cell--number">8</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0.89</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1103db24e225f7fd38f4c10fa3d0a22e1ac75c00" class="src_link" title="lib/type_balancer/rails/query/balanced_query.rb">lib/type_balancer/rails/query/balanced_query.rb</a></td>
            <td class="red strong cell--number t-file__coverage">38.30 %</td>
            <td class="cell--number">93</td>
            <td class="cell--number">47</td>
            <td class="cell--number">18</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0.38</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">0</td>
              <td class="cell--number">16</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4aa24b7c0b1325866ea406e0940f109e54442380" class="src_link" title="lib/type_balancer/rails/query/pagination_service.rb">lib/type_balancer/rails/query/pagination_service.rb</a></td>
            <td class="red strong cell--number t-file__coverage">51.11 %</td>
            <td class="cell--number">87</td>
            <td class="cell--number">45</td>
            <td class="cell--number">23</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0.51</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
              <td class="cell--number">6</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a9cbcce008672036bcf2f5c0bd4ec249aeb2d97a" class="src_link" title="lib/type_balancer/rails/query/position_manager.rb">lib/type_balancer/rails/query/position_manager.rb</a></td>
            <td class="red strong cell--number t-file__coverage">33.33 %</td>
            <td class="cell--number">97</td>
            <td class="cell--number">51</td>
            <td class="cell--number">17</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0.33</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">15</td>
              <td class="cell--number">0</td>
              <td class="cell--number">15</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#975c619efbc7c3a78fcb79e80ea2e8473a531f7b" class="src_link" title="lib/type_balancer/rails/railtie.rb">lib/type_balancer/rails/railtie.rb</a></td>
            <td class="red strong cell--number t-file__coverage">33.33 %</td>
            <td class="cell--number">27</td>
            <td class="cell--number">12</td>
            <td class="cell--number">4</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.33</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#04fec1c9149d946f7a7afdc61f054533003f0b78" class="src_link" title="lib/type_balancer/rails/storage.rb">lib/type_balancer/rails/storage.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">7</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9c12dc1be6485d0f97f072f2117c65806623218c" class="src_link" title="lib/type_balancer/rails/storage/base_storage.rb">lib/type_balancer/rails/storage/base_storage.rb</a></td>
            <td class="red strong cell--number t-file__coverage">53.85 %</td>
            <td class="cell--number">63</td>
            <td class="cell--number">26</td>
            <td class="cell--number">14</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0.54</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">0</td>
              <td class="cell--number">14</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#54c74bd733bdece15031694ad83bc14d6848d928" class="src_link" title="lib/type_balancer/rails/storage/cache_decorator.rb">lib/type_balancer/rails/storage/cache_decorator.rb</a></td>
            <td class="red strong cell--number t-file__coverage">46.43 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">28</td>
            <td class="cell--number">13</td>
            <td class="cell--number">15</td>
            <td class="cell--number">0.46</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4e497c16e17d52d85a03f248129f6b625c93ed62" class="src_link" title="lib/type_balancer/rails/storage/cursor_storage.rb">lib/type_balancer/rails/storage/cursor_storage.rb</a></td>
            <td class="red strong cell--number t-file__coverage">26.83 %</td>
            <td class="cell--number">73</td>
            <td class="cell--number">41</td>
            <td class="cell--number">11</td>
            <td class="cell--number">30</td>
            <td class="cell--number">0.27</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#08a37b119094a765949a0ce55e6dbdb1c8ab8ce9" class="src_link" title="lib/type_balancer/rails/storage/redis_storage.rb">lib/type_balancer/rails/storage/redis_storage.rb</a></td>
            <td class="red strong cell--number t-file__coverage">38.46 %</td>
            <td class="cell--number">72</td>
            <td class="cell--number">39</td>
            <td class="cell--number">15</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0.38</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">10</td>
              <td class="cell--number">0</td>
              <td class="cell--number">10</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#20ae1c430adfed18ddf0561ca5ee7705cd49a6a2" class="src_link" title="lib/type_balancer/rails/storage_strategies.rb">lib/type_balancer/rails/storage_strategies.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">8</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#65c4a4bad2349d52d5111ecebc4f1508ed48b030" class="src_link" title="lib/type_balancer/rails/strategies/base_strategy.rb">lib/type_balancer/rails/strategies/base_strategy.rb</a></td>
            <td class="red strong cell--number t-file__coverage">54.05 %</td>
            <td class="cell--number">72</td>
            <td class="cell--number">37</td>
            <td class="cell--number">20</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0.54</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
              <td class="cell--number">6</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2814ab5e5082d3e81e856a5b4e9af3f805ffeea7" class="src_link" title="lib/type_balancer/rails/strategies/redis_strategy.rb">lib/type_balancer/rails/strategies/redis_strategy.rb</a></td>
            <td class="red strong cell--number t-file__coverage">30.19 %</td>
            <td class="cell--number">95</td>
            <td class="cell--number">53</td>
            <td class="cell--number">16</td>
            <td class="cell--number">37</td>
            <td class="cell--number">0.30</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">0</td>
              <td class="cell--number">14</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e8bb0073eea3ec94587ab9cbe7658cb59bfdc013" class="src_link" title="lib/type_balancer/rails/strategies/storage_adapter.rb">lib/type_balancer/rails/strategies/storage_adapter.rb</a></td>
            <td class="red strong cell--number t-file__coverage">48.15 %</td>
            <td class="cell--number">52</td>
            <td class="cell--number">27</td>
            <td class="cell--number">13</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0.48</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d8c16f999a9abdab0b45548cd4c20c0883f9d01e" class="src_link" title="lib/type_balancer/rails/strategies/storage_strategy_registry.rb">lib/type_balancer/rails/strategies/storage_strategy_registry.rb</a></td>
            <td class="red strong cell--number t-file__coverage">56.25 %</td>
            <td class="cell--number">33</td>
            <td class="cell--number">16</td>
            <td class="cell--number">9</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0.56</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
              <td class="cell--number">2</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>


        
          <div class="file_list_container" id="Core">
  <h2>
    <span class="group_name">Core</span>
    (<span class="covered_percent">
      <span class="red">
  48.27%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.66
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Core"></a>

  <div>
    <b>27</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>810</b> relevant lines,
    <span class="green"><b>391</b> lines covered</span> and
    <span class="red"><b>419</b> lines missed. </span>
    (<span class="red">
  48.27%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>137</b> total branches, </span>
      <span class="green"><b>7</b> branches covered</span> and
      <span class="red"><b>130</b> branches missed.</span>
      (<span class="red">
  5.11%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5e8bf8df465eb88974842831147ca256a7322512" class="src_link" title="lib/type_balancer/rails.rb">lib/type_balancer/rails.rb</a></td>
            <td class="red strong cell--number t-file__coverage">62.50 %</td>
            <td class="cell--number">103</td>
            <td class="cell--number">64</td>
            <td class="cell--number">40</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0.63</td>
            
              <td class="red strong cell--number t-file__branch-coverage">12.50 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">1</td>
              <td class="cell--number">7</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c681e27e96c00fdbf43647ec08660ab23a6713e5" class="src_link" title="lib/type_balancer/rails/balance_calculation_job.rb">lib/type_balancer/rails/balance_calculation_job.rb</a></td>
            <td class="red strong cell--number t-file__coverage">37.04 %</td>
            <td class="cell--number">57</td>
            <td class="cell--number">27</td>
            <td class="cell--number">10</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0.37</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5d37d84a60cc36b2d9ee6085bc052131239c20b9" class="src_link" title="lib/type_balancer/rails/balanced_collection_query.rb">lib/type_balancer/rails/balanced_collection_query.rb</a></td>
            <td class="red strong cell--number t-file__coverage">34.04 %</td>
            <td class="cell--number">104</td>
            <td class="cell--number">47</td>
            <td class="cell--number">16</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0.34</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6288559a1a2fb19a5e118e5129fab92a902cde7d" class="src_link" title="lib/type_balancer/rails/balanced_position.rb">lib/type_balancer/rails/balanced_position.rb</a></td>
            <td class="red strong cell--number t-file__coverage">63.64 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">22</td>
            <td class="cell--number">14</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.64</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#45e4ba3844f798c613fa07b7e3a2b4e2ac5456e0" class="src_link" title="lib/type_balancer/rails/cache_invalidation.rb">lib/type_balancer/rails/cache_invalidation.rb</a></td>
            <td class="red strong cell--number t-file__coverage">80.00 %</td>
            <td class="cell--number">26</td>
            <td class="cell--number">10</td>
            <td class="cell--number">8</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.80</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#43eb50c5f1a1f1f4f272c4c24b5af82cf3205e51" class="src_link" title="lib/type_balancer/rails/configuration.rb">lib/type_balancer/rails/configuration.rb</a></td>
            <td class="red strong cell--number t-file__coverage">47.17 %</td>
            <td class="cell--number">105</td>
            <td class="cell--number">53</td>
            <td class="cell--number">25</td>
            <td class="cell--number">28</td>
            <td class="cell--number">0.47</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#38eed2f5f4a7fa08315034825651e4c079c4a632" class="src_link" title="lib/type_balancer/rails/configuration/cache_config.rb">lib/type_balancer/rails/configuration/cache_config.rb</a></td>
            <td class="red strong cell--number t-file__coverage">44.00 %</td>
            <td class="cell--number">45</td>
            <td class="cell--number">25</td>
            <td class="cell--number">11</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0.44</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#bc14be6bf640a0785effb864a2ffa0f104f45296" class="src_link" title="lib/type_balancer/rails/configuration/pagination_config.rb">lib/type_balancer/rails/configuration/pagination_config.rb</a></td>
            <td class="red strong cell--number t-file__coverage">47.37 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">19</td>
            <td class="cell--number">9</td>
            <td class="cell--number">10</td>
            <td class="cell--number">0.47</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2707f93a73ba0812f4ee473d66c7f7be6f25e234" class="src_link" title="lib/type_balancer/rails/configuration/redis_config.rb">lib/type_balancer/rails/configuration/redis_config.rb</a></td>
            <td class="red strong cell--number t-file__coverage">40.74 %</td>
            <td class="cell--number">46</td>
            <td class="cell--number">27</td>
            <td class="cell--number">11</td>
            <td class="cell--number">16</td>
            <td class="cell--number">0.41</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#826fd4e7903fad47f932ff722f5955bfbbda748c" class="src_link" title="lib/type_balancer/rails/configuration/storage_strategy_registry.rb">lib/type_balancer/rails/configuration/storage_strategy_registry.rb</a></td>
            <td class="red strong cell--number t-file__coverage">56.25 %</td>
            <td class="cell--number">33</td>
            <td class="cell--number">16</td>
            <td class="cell--number">9</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0.56</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7e3aaf4adbd5843c96c549c400036700b7abd871" class="src_link" title="lib/type_balancer/rails/container.rb">lib/type_balancer/rails/container.rb</a></td>
            <td class="red strong cell--number t-file__coverage">45.45 %</td>
            <td class="cell--number">49</td>
            <td class="cell--number">22</td>
            <td class="cell--number">10</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0.45</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#be8775049c93fa54a1c70683f77d3d07e9a6f2a5" class="src_link" title="lib/type_balancer/rails/core.rb">lib/type_balancer/rails/core.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">59</td>
            <td class="cell--number">32</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5.47</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0ef718a947790cf19351a6ad73609bd6143edf55" class="src_link" title="lib/type_balancer/rails/query.rb">lib/type_balancer/rails/query.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.89 %</td>
            <td class="cell--number">18</td>
            <td class="cell--number">9</td>
            <td class="cell--number">8</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0.89</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1103db24e225f7fd38f4c10fa3d0a22e1ac75c00" class="src_link" title="lib/type_balancer/rails/query/balanced_query.rb">lib/type_balancer/rails/query/balanced_query.rb</a></td>
            <td class="red strong cell--number t-file__coverage">38.30 %</td>
            <td class="cell--number">93</td>
            <td class="cell--number">47</td>
            <td class="cell--number">18</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0.38</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">0</td>
              <td class="cell--number">16</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4aa24b7c0b1325866ea406e0940f109e54442380" class="src_link" title="lib/type_balancer/rails/query/pagination_service.rb">lib/type_balancer/rails/query/pagination_service.rb</a></td>
            <td class="red strong cell--number t-file__coverage">51.11 %</td>
            <td class="cell--number">87</td>
            <td class="cell--number">45</td>
            <td class="cell--number">23</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0.51</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
              <td class="cell--number">6</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a9cbcce008672036bcf2f5c0bd4ec249aeb2d97a" class="src_link" title="lib/type_balancer/rails/query/position_manager.rb">lib/type_balancer/rails/query/position_manager.rb</a></td>
            <td class="red strong cell--number t-file__coverage">33.33 %</td>
            <td class="cell--number">97</td>
            <td class="cell--number">51</td>
            <td class="cell--number">17</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0.33</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">15</td>
              <td class="cell--number">0</td>
              <td class="cell--number">15</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#975c619efbc7c3a78fcb79e80ea2e8473a531f7b" class="src_link" title="lib/type_balancer/rails/railtie.rb">lib/type_balancer/rails/railtie.rb</a></td>
            <td class="red strong cell--number t-file__coverage">33.33 %</td>
            <td class="cell--number">27</td>
            <td class="cell--number">12</td>
            <td class="cell--number">4</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.33</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#04fec1c9149d946f7a7afdc61f054533003f0b78" class="src_link" title="lib/type_balancer/rails/storage.rb">lib/type_balancer/rails/storage.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">7</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9c12dc1be6485d0f97f072f2117c65806623218c" class="src_link" title="lib/type_balancer/rails/storage/base_storage.rb">lib/type_balancer/rails/storage/base_storage.rb</a></td>
            <td class="red strong cell--number t-file__coverage">53.85 %</td>
            <td class="cell--number">63</td>
            <td class="cell--number">26</td>
            <td class="cell--number">14</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0.54</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">0</td>
              <td class="cell--number">14</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#54c74bd733bdece15031694ad83bc14d6848d928" class="src_link" title="lib/type_balancer/rails/storage/cache_decorator.rb">lib/type_balancer/rails/storage/cache_decorator.rb</a></td>
            <td class="red strong cell--number t-file__coverage">46.43 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">28</td>
            <td class="cell--number">13</td>
            <td class="cell--number">15</td>
            <td class="cell--number">0.46</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4e497c16e17d52d85a03f248129f6b625c93ed62" class="src_link" title="lib/type_balancer/rails/storage/cursor_storage.rb">lib/type_balancer/rails/storage/cursor_storage.rb</a></td>
            <td class="red strong cell--number t-file__coverage">26.83 %</td>
            <td class="cell--number">73</td>
            <td class="cell--number">41</td>
            <td class="cell--number">11</td>
            <td class="cell--number">30</td>
            <td class="cell--number">0.27</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#08a37b119094a765949a0ce55e6dbdb1c8ab8ce9" class="src_link" title="lib/type_balancer/rails/storage/redis_storage.rb">lib/type_balancer/rails/storage/redis_storage.rb</a></td>
            <td class="red strong cell--number t-file__coverage">38.46 %</td>
            <td class="cell--number">72</td>
            <td class="cell--number">39</td>
            <td class="cell--number">15</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0.38</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">10</td>
              <td class="cell--number">0</td>
              <td class="cell--number">10</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#20ae1c430adfed18ddf0561ca5ee7705cd49a6a2" class="src_link" title="lib/type_balancer/rails/storage_strategies.rb">lib/type_balancer/rails/storage_strategies.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">8</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#65c4a4bad2349d52d5111ecebc4f1508ed48b030" class="src_link" title="lib/type_balancer/rails/strategies/base_strategy.rb">lib/type_balancer/rails/strategies/base_strategy.rb</a></td>
            <td class="red strong cell--number t-file__coverage">54.05 %</td>
            <td class="cell--number">72</td>
            <td class="cell--number">37</td>
            <td class="cell--number">20</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0.54</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
              <td class="cell--number">6</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2814ab5e5082d3e81e856a5b4e9af3f805ffeea7" class="src_link" title="lib/type_balancer/rails/strategies/redis_strategy.rb">lib/type_balancer/rails/strategies/redis_strategy.rb</a></td>
            <td class="red strong cell--number t-file__coverage">30.19 %</td>
            <td class="cell--number">95</td>
            <td class="cell--number">53</td>
            <td class="cell--number">16</td>
            <td class="cell--number">37</td>
            <td class="cell--number">0.30</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">0</td>
              <td class="cell--number">14</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e8bb0073eea3ec94587ab9cbe7658cb59bfdc013" class="src_link" title="lib/type_balancer/rails/strategies/storage_adapter.rb">lib/type_balancer/rails/strategies/storage_adapter.rb</a></td>
            <td class="red strong cell--number t-file__coverage">48.15 %</td>
            <td class="cell--number">52</td>
            <td class="cell--number">27</td>
            <td class="cell--number">13</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0.48</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d8c16f999a9abdab0b45548cd4c20c0883f9d01e" class="src_link" title="lib/type_balancer/rails/strategies/storage_strategy_registry.rb">lib/type_balancer/rails/strategies/storage_strategy_registry.rb</a></td>
            <td class="red strong cell--number t-file__coverage">56.25 %</td>
            <td class="cell--number">33</td>
            <td class="cell--number">16</td>
            <td class="cell--number">9</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0.56</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
              <td class="cell--number">2</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="ActiveRecord">
  <h2>
    <span class="group_name">ActiveRecord</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="ActiveRecord"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>0</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Storage">
  <h2>
    <span class="group_name">Storage</span>
    (<span class="covered_percent">
      <span class="red">
  45.64%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.46
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Storage"></a>

  <div>
    <b>6</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>149</b> relevant lines,
    <span class="green"><b>68</b> lines covered</span> and
    <span class="red"><b>81</b> lines missed. </span>
    (<span class="red">
  45.64%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>36</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>36</b> branches missed.</span>
      (<span class="red">
  0.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#04fec1c9149d946f7a7afdc61f054533003f0b78" class="src_link" title="lib/type_balancer/rails/storage.rb">lib/type_balancer/rails/storage.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">7</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9c12dc1be6485d0f97f072f2117c65806623218c" class="src_link" title="lib/type_balancer/rails/storage/base_storage.rb">lib/type_balancer/rails/storage/base_storage.rb</a></td>
            <td class="red strong cell--number t-file__coverage">53.85 %</td>
            <td class="cell--number">63</td>
            <td class="cell--number">26</td>
            <td class="cell--number">14</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0.54</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">0</td>
              <td class="cell--number">14</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#54c74bd733bdece15031694ad83bc14d6848d928" class="src_link" title="lib/type_balancer/rails/storage/cache_decorator.rb">lib/type_balancer/rails/storage/cache_decorator.rb</a></td>
            <td class="red strong cell--number t-file__coverage">46.43 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">28</td>
            <td class="cell--number">13</td>
            <td class="cell--number">15</td>
            <td class="cell--number">0.46</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4e497c16e17d52d85a03f248129f6b625c93ed62" class="src_link" title="lib/type_balancer/rails/storage/cursor_storage.rb">lib/type_balancer/rails/storage/cursor_storage.rb</a></td>
            <td class="red strong cell--number t-file__coverage">26.83 %</td>
            <td class="cell--number">73</td>
            <td class="cell--number">41</td>
            <td class="cell--number">11</td>
            <td class="cell--number">30</td>
            <td class="cell--number">0.27</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#08a37b119094a765949a0ce55e6dbdb1c8ab8ce9" class="src_link" title="lib/type_balancer/rails/storage/redis_storage.rb">lib/type_balancer/rails/storage/redis_storage.rb</a></td>
            <td class="red strong cell--number t-file__coverage">38.46 %</td>
            <td class="cell--number">72</td>
            <td class="cell--number">39</td>
            <td class="cell--number">15</td>
            <td class="cell--number">24</td>
            <td class="cell--number">0.38</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">10</td>
              <td class="cell--number">0</td>
              <td class="cell--number">10</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#20ae1c430adfed18ddf0561ca5ee7705cd49a6a2" class="src_link" title="lib/type_balancer/rails/storage_strategies.rb">lib/type_balancer/rails/storage_strategies.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">8</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Query">
  <h2>
    <span class="group_name">Query</span>
    (<span class="covered_percent">
      <span class="red">
  43.42%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.43
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Query"></a>

  <div>
    <b>4</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>152</b> relevant lines,
    <span class="green"><b>66</b> lines covered</span> and
    <span class="red"><b>86</b> lines missed. </span>
    (<span class="red">
  43.42%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>37</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>37</b> branches missed.</span>
      (<span class="red">
  0.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0ef718a947790cf19351a6ad73609bd6143edf55" class="src_link" title="lib/type_balancer/rails/query.rb">lib/type_balancer/rails/query.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.89 %</td>
            <td class="cell--number">18</td>
            <td class="cell--number">9</td>
            <td class="cell--number">8</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0.89</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1103db24e225f7fd38f4c10fa3d0a22e1ac75c00" class="src_link" title="lib/type_balancer/rails/query/balanced_query.rb">lib/type_balancer/rails/query/balanced_query.rb</a></td>
            <td class="red strong cell--number t-file__coverage">38.30 %</td>
            <td class="cell--number">93</td>
            <td class="cell--number">47</td>
            <td class="cell--number">18</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0.38</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">0</td>
              <td class="cell--number">16</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4aa24b7c0b1325866ea406e0940f109e54442380" class="src_link" title="lib/type_balancer/rails/query/pagination_service.rb">lib/type_balancer/rails/query/pagination_service.rb</a></td>
            <td class="red strong cell--number t-file__coverage">51.11 %</td>
            <td class="cell--number">87</td>
            <td class="cell--number">45</td>
            <td class="cell--number">23</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0.51</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
              <td class="cell--number">6</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a9cbcce008672036bcf2f5c0bd4ec249aeb2d97a" class="src_link" title="lib/type_balancer/rails/query/position_manager.rb">lib/type_balancer/rails/query/position_manager.rb</a></td>
            <td class="red strong cell--number t-file__coverage">33.33 %</td>
            <td class="cell--number">97</td>
            <td class="cell--number">51</td>
            <td class="cell--number">17</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0.33</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">15</td>
              <td class="cell--number">0</td>
              <td class="cell--number">15</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Config">
  <h2>
    <span class="group_name">Config</span>
    (<span class="covered_percent">
      <span class="red">
  46.43%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.46
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Config"></a>

  <div>
    <b>5</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>140</b> relevant lines,
    <span class="green"><b>65</b> lines covered</span> and
    <span class="red"><b>75</b> lines missed. </span>
    (<span class="red">
  46.43%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>16</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>16</b> branches missed.</span>
      (<span class="red">
  0.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#43eb50c5f1a1f1f4f272c4c24b5af82cf3205e51" class="src_link" title="lib/type_balancer/rails/configuration.rb">lib/type_balancer/rails/configuration.rb</a></td>
            <td class="red strong cell--number t-file__coverage">47.17 %</td>
            <td class="cell--number">105</td>
            <td class="cell--number">53</td>
            <td class="cell--number">25</td>
            <td class="cell--number">28</td>
            <td class="cell--number">0.47</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#38eed2f5f4a7fa08315034825651e4c079c4a632" class="src_link" title="lib/type_balancer/rails/configuration/cache_config.rb">lib/type_balancer/rails/configuration/cache_config.rb</a></td>
            <td class="red strong cell--number t-file__coverage">44.00 %</td>
            <td class="cell--number">45</td>
            <td class="cell--number">25</td>
            <td class="cell--number">11</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0.44</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#bc14be6bf640a0785effb864a2ffa0f104f45296" class="src_link" title="lib/type_balancer/rails/configuration/pagination_config.rb">lib/type_balancer/rails/configuration/pagination_config.rb</a></td>
            <td class="red strong cell--number t-file__coverage">47.37 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">19</td>
            <td class="cell--number">9</td>
            <td class="cell--number">10</td>
            <td class="cell--number">0.47</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2707f93a73ba0812f4ee473d66c7f7be6f25e234" class="src_link" title="lib/type_balancer/rails/configuration/redis_config.rb">lib/type_balancer/rails/configuration/redis_config.rb</a></td>
            <td class="red strong cell--number t-file__coverage">40.74 %</td>
            <td class="cell--number">46</td>
            <td class="cell--number">27</td>
            <td class="cell--number">11</td>
            <td class="cell--number">16</td>
            <td class="cell--number">0.41</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#826fd4e7903fad47f932ff722f5955bfbbda748c" class="src_link" title="lib/type_balancer/rails/configuration/storage_strategy_registry.rb">lib/type_balancer/rails/configuration/storage_strategy_registry.rb</a></td>
            <td class="red strong cell--number t-file__coverage">56.25 %</td>
            <td class="cell--number">33</td>
            <td class="cell--number">16</td>
            <td class="cell--number">9</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0.56</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
              <td class="cell--number">2</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.22.0
        and simplecov-html v0.13.1<br/>
        using RSpec
      </div>

      <div class="source_files">
      
        <div class="source_table" id="5e8bf8df465eb88974842831147ca256a7322512">
  <div class="header">
    <h3>lib/type_balancer/rails.rb</h3>
    <h4>
      <span class="red">
  62.5%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  12.5%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>64</b> relevant lines.
      <span class="green"><b>40</b> lines covered</span> and
      <span class="red"><b>24</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>1</b> branches covered</span> and
          <span class="red"><b>7</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require &#39;active_support/all&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require &#39;active_record&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require &#39;active_job&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require &#39;redis&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require &#39;type_balancer&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;rails/core&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;rails/storage&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;rails/query&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;rails/version&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;rails/balanced_position&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;rails/cache_invalidation&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;rails/balance_calculation_job&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;rails/balanced_collection_query&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;rails/container&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;rails/storage_strategies&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;rails/strategies/storage_strategy_registry&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;rails/strategies/storage_adapter&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">require_relative &#39;rails/railtie&#39; if defined?(Rails)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;rails/configuration&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  # Rails integration for TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    extend ActiveSupport::Autoload</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    include Core::ConfigurationFacade</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      delegate :configuration, :configure, :reset!, to: Core</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      delegate :strategy_manager, to: :configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      delegate :storage_adapter, to: :configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def initialize!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            

            
              
            

            <code class="ruby">        register_defaults</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            

            
              
            

            <code class="ruby">        reset!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            

            
              
            

            <code class="ruby">        self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def register_defaults</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            

            
              
            

            <code class="ruby">        register_storage_strategies</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            

            
              
            

            <code class="ruby">        configure_cache_defaults</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            

            
              
            

            <code class="ruby">        self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def register_strategy(name, strategy_class)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            

            
              
            

            <code class="ruby">        strategy_manager.register(name, strategy_class)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            

            
              
            

            <code class="ruby">        self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def resolve_strategy(name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            

            
              
            

            <code class="ruby">        strategy_manager.resolve(name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def configure_redis(&amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="60">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        configuration.redis_client = yield if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            

            
              
            

            <code class="ruby">        self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def configure_cache(&amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="65">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        configuration.cache_store = yield if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            

            
              
            

            <code class="ruby">        self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def method_missing(method_name, *, &amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="70">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">        if configuration.respond_to?(method_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            

            
              
            

            <code class="ruby">          configuration.public_send(method_name, *, &amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="72">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            

            
              
            

            <code class="ruby">          super</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="77">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def respond_to_missing?(method_name, include_private = false)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            

            
              
            

            <code class="ruby">        configuration.respond_to?(method_name, include_private) || super</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="83">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def register_storage_strategies</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            

            
              
            

            <code class="ruby">        configure do |config|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            

            
              
            

            <code class="ruby">          config.strategy_manager = TypeBalancer::Rails::Strategies::StorageStrategyRegistry.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            

            
              
            

            <code class="ruby">          config.storage_adapter = TypeBalancer::Rails::Strategies::StorageAdapter.new(config.strategy_manager)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="90">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def configure_cache_defaults</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            

            
              
            

            <code class="ruby">        configure do |config|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            

            
              
            

            <code class="ruby">          config.configure_cache do |cache|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            

            
              
            

            <code class="ruby">            cache.options[:namespace] = &#39;type_balancer&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            

            
              
            

            <code class="ruby">            cache.options[:expires_in] = config.cache_ttl</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby"># Include CacheInvalidation in ActiveRecord::Base for testing</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="103">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">ActiveRecord::Base.include TypeBalancer::Rails::CacheInvalidation</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c681e27e96c00fdbf43647ec08660ab23a6713e5">
  <div class="header">
    <h3>lib/type_balancer/rails/balance_calculation_job.rb</h3>
    <h4>
      <span class="red">
  37.04%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>27</b> relevant lines.
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>17</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    # Background job for calculating and storing balanced positions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class BalanceCalculationJob &lt; ::ActiveJob::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      queue_as :default</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def perform(scope, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">        @scope = scope</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">        @options = options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">        ActiveRecord::Base.transaction do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            
              
            

            <code class="ruby">          positions = calculate_positions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">          store_positions(positions)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">          broadcast_completion</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def calculate_positions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            
              
            

            <code class="ruby">        TypeBalancer.calculate_positions(collection: @scope, options: @options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def store_positions(positions)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            

            
              
            

            <code class="ruby">        cache_key = generate_cache_key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">        # Clear existing positions for this cache key</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">        BalancedPosition.for_collection(cache_key).delete_all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">        # Store new positions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            

            
              
            

            <code class="ruby">        positions.each_with_index do |record_id, index|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            

            
              
            

            <code class="ruby">          BalancedPosition.create!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">            record_type: @scope.klass.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">            record_id: record_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">            position: index + 1,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">            cache_key: cache_key,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">            type_field: @options[:type_field]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">          )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def broadcast_completion</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            

            
              
            

            <code class="ruby">        channel = &quot;type_balancer_#{@scope.klass.table_name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            

            
              
            

            <code class="ruby">        ActionCable.server.broadcast(channel, status: &#39;completed&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def generate_cache_key</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            

            
              
            

            <code class="ruby">        base = &quot;type_balancer/#{@scope.klass.table_name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            

            
              
            

            <code class="ruby">        scope_key = @scope.cache_key_with_version</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            

            
              
            

            <code class="ruby">        options_key = Digest::MD5.hexdigest(@options.to_json)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            

            
              
            

            <code class="ruby">        &quot;#{base}/#{scope_key}/#{options_key}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5d37d84a60cc36b2d9ee6085bc052131239c20b9">
  <div class="header">
    <h3>lib/type_balancer/rails/balanced_collection_query.rb</h3>
    <h4>
      <span class="red">
  34.04%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>47</b> relevant lines.
      <span class="green"><b>16</b> lines covered</span> and
      <span class="red"><b>31</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>4</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    # Handles querying and pagination of balanced collections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class BalancedCollectionQuery</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      attr_reader :scope, :options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def initialize(scope, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="10">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        @scope = scope[:collection] if scope.is_a?(Hash) &amp;&amp; scope[:collection]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">        @scope ||= scope</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            

            
              
            

            <code class="ruby">        @options = options</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">        @per_page = options[:per_page] || 25</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def execute</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            
              
            

            <code class="ruby">        fetch_or_calculate_positions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def background_processing?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">        scope.count &gt; TypeBalancer::Rails.configuration.background_processing_threshold</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def page(num)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">        positions = fetch_or_calculate_positions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">        paginate_by_positions(positions, num)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def per(count)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">        @per_page = [</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            

            
              
            

            <code class="ruby">          count.to_i,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">          TypeBalancer::Rails.configuration.max_per_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">        ].min</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            

            
              
            

            <code class="ruby">        self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def infer_type_field</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            

            
              
            

            <code class="ruby">        %w[type media_type content_type category].find do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            

            
              
            

            <code class="ruby">          scope.column_names.include?(field)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">        end || raise(ArgumentError, &#39;No type field found. Please specify one using balance_by_type(field: :your_field)&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def fetch_or_calculate_positions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            

            
              
            

            <code class="ruby">        cache_key = generate_cache_key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            

            
              
            

            <code class="ruby">        ::Rails.cache.fetch(cache_key, expires_in: TypeBalancer::Rails.configuration.cache_ttl) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            

            
              
            

            <code class="ruby">          calculate_and_store_positions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="53">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def calculate_and_store_positions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">        # Calculate positions using the core gem</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            

            
              
            

            <code class="ruby">        positions = TypeBalancer.calculate_positions(collection: @scope, options: @options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">        # Store positions in the database</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            

            
              
            

            <code class="ruby">        store_positions(positions)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">        # Return the positions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            

            
              
            

            <code class="ruby">        positions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def store_positions(positions)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            

            
              
            

            <code class="ruby">        cache_key = generate_cache_key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            

            
              
            

            <code class="ruby">        ActiveRecord::Base.transaction do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">          # Clear existing positions for this cache key</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            

            
              
            

            <code class="ruby">          BalancedPosition.for_collection(cache_key).delete_all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">          # Store new positions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            

            
              
            

            <code class="ruby">          positions.each_with_index do |record_id, index|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            

            
              
            

            <code class="ruby">            BalancedPosition.create!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">              record_type: scope.klass.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">              record_id: record_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">              position: index + 1,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">              cache_key: cache_key,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">              type_field: @options[:type_field]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">            )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="84">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def paginate_by_positions(positions, page_num)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            

            
              
            

            <code class="ruby">        offset = (page_num - 1) * @per_page</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            

            
              
            

            <code class="ruby">        page_positions = positions[offset, @per_page] || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">        # Return empty scope if no positions for this page</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="89">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        return @scope.none if page_positions.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">        # Order by the calculated positions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            

            
              
            

            <code class="ruby">        @scope.where(id: page_positions)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">              .order(Arel.sql(&quot;FIELD(id, #{page_positions.join(&#39;,&#39;)})&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="96">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def generate_cache_key</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            

            
              
            

            <code class="ruby">        base = &quot;type_balancer/#{scope.klass.table_name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            

            
              
            

            <code class="ruby">        scope_key = scope.cache_key_with_version</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            

            
              
            

            <code class="ruby">        options_key = Digest::MD5.hexdigest(@options.to_json)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            

            
              
            

            <code class="ruby">        &quot;#{base}/#{scope_key}/#{options_key}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6288559a1a2fb19a5e118e5129fab92a902cde7d">
  <div class="header">
    <h3>lib/type_balancer/rails/balanced_position.rb</h3>
    <h4>
      <span class="red">
  63.64%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>22</b> relevant lines.
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    # Stores balanced positions for records in a collection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class BalancedPosition &lt; ::ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      self.table_name = &#39;type_balancer_balanced_positions&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      belongs_to :record, polymorphic: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      validates :record, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      validates :position, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      validates :cache_key, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      validates :position, uniqueness: { scope: :cache_key }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      validates :record_id, uniqueness: { scope: %i[record_type cache_key] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      scope :for_collection, -&gt;(cache_key) { where(cache_key: cache_key).order(:position) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      scope :for_record, -&gt;(record) { where(record: record) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def table_definition</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">          proc do |t|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            
              
            

            <code class="ruby">            t.references :record, polymorphic: true, null: false</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            

            
              
            

            <code class="ruby">            t.integer :position, null: false</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">            t.string :cache_key, null: false</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">            t.string :type_field</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            

            
              
            

            <code class="ruby">            t.timestamps</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            

            
              
            

            <code class="ruby">            t.index %i[cache_key position], unique: true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">            t.index %i[record_type record_id cache_key], unique: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="45e4ba3844f798c613fa07b7e3a2b4e2ac5456e0">
  <div class="header">
    <h3>lib/type_balancer/rails/cache_invalidation.rb</h3>
    <h4>
      <span class="red">
  80.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>10</b> relevant lines.
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    # Handles cache invalidation for balanced collections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module CacheInvalidation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      included do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        include ::ActiveRecord::Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        after_commit :invalidate_balance_cache, if: :persisted?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def invalidate_balance_cache</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">        # Delete all cache entries for this model type</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">        ::Rails.cache.delete_matched(&quot;type_balancer/#{self.class.table_name}/*&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">        # Delete all balanced positions for this record</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">        TypeBalancer::Rails::BalancedPosition.where(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">          record_type: self.class.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">          record_id: id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">        ).delete_all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="43eb50c5f1a1f1f4f272c4c24b5af82cf3205e51">
  <div class="header">
    <h3>lib/type_balancer/rails/configuration.rb</h3>
    <h4>
      <span class="red">
  47.17%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>53</b> relevant lines.
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>28</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>4</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      attr_accessor :redis_client, :redis_enabled, :redis_ttl,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">                    :cache_enabled, :cache_ttl, :cache_store,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">                    :storage_strategy, :max_per_page, :cursor_buffer_multiplier</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      attr_reader :strategy_manager, :storage_adapter</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class StorageStrategyRegistry</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">          @strategies = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def register(name, strategy)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">          @strategies[name.to_sym] = strategy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def [](name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">          @strategies[name.to_sym]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        delegate :clear, to: :@strategies</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class StorageAdapter</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            

            
              
            

            <code class="ruby">          @adapter = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_accessor :adapter</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            

            
              
            

            <code class="ruby">        @redis_enabled = true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            

            
              
            

            <code class="ruby">        @cache_enabled = true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            

            
              
            

            <code class="ruby">        @cache_ttl = 3600 # 1 hour default</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            

            
              
            

            <code class="ruby">        @storage_strategy = :redis</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            

            
              
            

            <code class="ruby">        @strategy_manager = StorageStrategyRegistry.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            

            
              
            

            <code class="ruby">        @storage_adapter = StorageAdapter.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            

            
              
            

            <code class="ruby">        register_default_strategies</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            

            
              
            

            <code class="ruby">        reset!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      delegate :register_strategy, to: :TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def redis_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            

            
              
            

            <code class="ruby">        @redis_enabled &amp;&amp; !@redis_client.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def reset!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            

            
              
            

            <code class="ruby">        @redis_ttl = 3600 # 1 hour default</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            

            
              
            

            <code class="ruby">        @cache_store = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            

            
              
            

            <code class="ruby">        @max_per_page = 100</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            

            
              
            

            <code class="ruby">        @cursor_buffer_multiplier = 1.5</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            

            
              
            

            <code class="ruby">        TypeBalancer.reset!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def redis_settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            

            
              
            

            <code class="ruby">          enabled: redis_enabled?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">          client: @redis_client,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">          ttl: @redis_ttl</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="66">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def cache_settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            

            
              
            

            <code class="ruby">          enabled: @cache_enabled,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">          store: @cache_store,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">          ttl: @cache_ttl</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def storage_settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            

            
              
            

            <code class="ruby">          strategy: @storage_strategy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="80">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def pagination_settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            

            
              
            

            <code class="ruby">          max_per_page: @max_per_page,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">          cursor_buffer_multiplier: @cursor_buffer_multiplier</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="87">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def configure_redis(&amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="88">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        @redis_client = yield if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            

            
              
            

            <code class="ruby">        self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="92">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def configure_cache(&amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="93">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        yield ::Rails.cache if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            

            
              
            

            <code class="ruby">        self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="97">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="99">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      def register_default_strategies</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            

            
              
            

            <code class="ruby">        strategy_manager.register(:redis, Strategies::RedisStrategy)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            

            
              
            

            <code class="ruby">        strategy_manager.register(:cursor, Strategies::CursorStrategy)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="38eed2f5f4a7fa08315034825651e4c079c4a632">
  <div class="header">
    <h3>lib/type_balancer/rails/configuration/cache_config.rb</h3>
    <h4>
      <span class="red">
  44.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>25</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>14</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>4</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Configuration for caching</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class CacheConfig</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :store, :enabled, :ttl</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize(enabled: true, ttl: 3600)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">          @enabled = enabled</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            

            
              
            

            <code class="ruby">          @ttl = ttl</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">          @store = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def configure(store = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="17">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          if store</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">            ::Rails.cache = store</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">            @store = store</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="21">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          yield(::Rails.cache) if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">          self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def enable!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">          @enabled = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def disable!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">          @enabled = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def ttl=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            

            
              
            

            <code class="ruby">          @ttl = value.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def reset!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            

            
              
            

            <code class="ruby">          @enabled = true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            

            
              
            

            <code class="ruby">          @store = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            

            
              
            

            <code class="ruby">          @ttl = 3600</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="bc14be6bf640a0785effb864a2ffa0f104f45296">
  <div class="header">
    <h3>lib/type_balancer/rails/configuration/pagination_config.rb</h3>
    <h4>
      <span class="red">
  47.37%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>19</b> relevant lines.
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>10</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>4</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Configuration for pagination</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class PaginationConfig</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :max_per_page, :cursor_buffer_multiplier</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize(max_per_page: 100, cursor_buffer_multiplier: 1.5)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">          @max_per_page = max_per_page</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            

            
              
            

            <code class="ruby">          @cursor_buffer_multiplier = cursor_buffer_multiplier</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def set_max_per_page(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">          value = value.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="17">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          return if value &lt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">          @max_per_page = value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def set_buffer_multiplier(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            
              
            

            <code class="ruby">          value = value.to_f</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="24">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          return if value &lt;= 1.0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">          @cursor_buffer_multiplier = value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def reset!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">          @max_per_page = 100</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            

            
              
            

            <code class="ruby">          @cursor_buffer_multiplier = 1.5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2707f93a73ba0812f4ee473d66c7f7be6f25e234">
  <div class="header">
    <h3>lib/type_balancer/rails/configuration/redis_config.rb</h3>
    <h4>
      <span class="red">
  40.74%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>27</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>16</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Configuration for Redis</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class RedisConfig</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :client, :ttl</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize(ttl: 3600)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">          @enabled = false</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            

            
              
            

            <code class="ruby">          @ttl = ttl</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">          @client = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def configure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            
              
            

            <code class="ruby">          require &#39;redis&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">          @client = Redis.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="19">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          yield(self) if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">          @enabled = true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">          self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def register_client(client)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">          @client = client</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">          @enabled = true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            

            
              
            

            <code class="ruby">          self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            

            
              
            

            <code class="ruby">          @enabled</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def ttl=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            

            
              
            

            <code class="ruby">          @ttl = value.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def reset!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            

            
              
            

            <code class="ruby">          @enabled = false</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            

            
              
            

            <code class="ruby">          @client = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            

            
              
            

            <code class="ruby">          @ttl = 3600</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="826fd4e7903fad47f932ff722f5955bfbbda748c">
  <div class="header">
    <h3>lib/type_balancer/rails/configuration/storage_strategy_registry.rb</h3>
    <h4>
      <span class="red">
  56.25%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>16</b> relevant lines.
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Registry for storage strategies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class StorageStrategyRegistry</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">          @strategies = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def register(name, strategy)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">          @strategies[name.to_sym] = strategy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def resolve(name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            
              
            

            <code class="ruby">          strategy = @strategies[name.to_sym]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="18">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          raise KeyError, &quot;Unknown storage strategy: #{name}&quot; unless strategy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">          strategy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def registered_strategies</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            

            
              
            

            <code class="ruby">          @strategies.keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def reset!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            

            
              
            

            <code class="ruby">          @strategies = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7e3aaf4adbd5843c96c549c400036700b7abd871">
  <div class="header">
    <h3>lib/type_balancer/rails/container.rb</h3>
    <h4>
      <span class="red">
  45.45%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>22</b> relevant lines.
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>12</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>4</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class Container</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def register(name, value = nil, cache: true, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="8">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          registry[name] = if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">                             {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">                               block: block,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">                               cache: cache</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">                             }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="13">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">                           else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">                             {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">                               block: -&gt; { value },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">                               cache: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">                             }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">                           end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">          cache_store.delete(name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def resolve(name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            
              
            

            <code class="ruby">          registration = registry.fetch(name) { raise KeyError, &quot;Service not registered: #{name}&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="25">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          if registration[:cache]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">            cache_store[name] ||= registration[:block].call</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="27">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            

            
              
            

            <code class="ruby">            registration[:block].call</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def reset!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            

            
              
            

            <code class="ruby">          @registry = {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            

            
              
            

            <code class="ruby">          @cache_store = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def registry</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            

            
              
            

            <code class="ruby">          @registry ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def cache_store</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            

            
              
            

            <code class="ruby">          @cache_store ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="be8775049c93fa54a1c70683f77d3d07e9a6f2a5">
  <div class="header">
    <h3>lib/type_balancer/rails/core.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>32</b> relevant lines.
      <span class="green"><b>32</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>6</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require &#39;active_support&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    # Core configuration module</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Core</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      module ConfigurationFacade</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def self.included(base)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">          base.extend(ClassMethods)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        module ClassMethods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">          def configuration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="16">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">            @configuration ||= Configuration.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">          def configure</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="20">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">            yield configuration if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="21">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">            self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">          def reset!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="25">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">            configuration.reset!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="26">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">            self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      extend ConfigurationFacade::ClassMethods</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_accessor :strategy_manager, :storage_adapter, :redis_client, :cache_ttl</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="37">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">          reset!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def configure_redis</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="41">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">          yield @redis_client if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="42">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">          self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def configure_cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="46">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">          yield ::Rails.cache if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="47">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">          self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def reset!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="51">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">          @strategy_manager = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="52">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">          @storage_adapter = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="53">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">          @redis_client = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="54">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">          @cache_ttl = 3600</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0ef718a947790cf19351a6ad73609bd6143edf55">
  <div class="header">
    <h3>lib/type_balancer/rails/query.rb</h3>
    <h4>
      <span class="yellow">
  88.89%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;query/balanced_query&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;query/pagination_service&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;query/position_manager&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    # Query module that ties together all query-related components</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Query</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def build(scope, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">          BalancedQuery.new(scope, options).build</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="1103db24e225f7fd38f4c10fa3d0a22e1ac75c00">
  <div class="header">
    <h3>lib/type_balancer/rails/query/balanced_query.rb</h3>
    <h4>
      <span class="red">
  38.3%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>47</b> relevant lines.
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>29</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>16</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>16</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Query</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Handles building and manipulation of balanced collection queries</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class BalancedQuery</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :scope, :options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize(scope, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">          @scope = extract_scope(scope)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            

            
              
            

            <code class="ruby">          @options = default_options.merge(options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">          @type_field = options[:type_field]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def build</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            
              
            

            <code class="ruby">          validate!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">          apply_type_field</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">          apply_order</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">          apply_conditions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">          scope</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def with_options(new_options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">          self.class.new(scope, options.merge(new_options))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :type_field</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def extract_scope(scope_or_hash)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="33">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          return scope_or_hash[:collection] if scope_or_hash.is_a?(Hash) &amp;&amp; scope_or_hash[:collection]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            

            
              
            

            <code class="ruby">          scope_or_hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def default_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            

            
              
            

            <code class="ruby">            order: nil,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">            conditions: {},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">            type_field: nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def validate!</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="47">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;Scope cannot be nil&#39; if scope.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="48">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;Scope must be an ActiveRecord::Relation&#39; unless scope.is_a?(ActiveRecord::Relation)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="50">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          return if type_field || inferred_type_field</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            

            
              
            

            <code class="ruby">          raise ArgumentError, &#39;No type field found. Please specify one using type_field: :your_field&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def apply_type_field</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            

            
              
            

            <code class="ruby">          @type_field ||= inferred_type_field</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def apply_order</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="60">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          return unless options[:order]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            

            
              
            

            <code class="ruby">          order_clause = sanitize_order(options[:order])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            

            
              
            

            <code class="ruby">          @scope = scope.order(order_clause)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="66">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def apply_conditions</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="67">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          return if options[:conditions].empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            

            
              
            

            <code class="ruby">          @scope = scope.where(options[:conditions])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="72">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def inferred_type_field</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            

            
              
            

            <code class="ruby">          %w[type media_type content_type category].find do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            

            
              
            

            <code class="ruby">            scope.column_names.include?(field)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="78">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def sanitize_order(order)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            

            
              
            

            <code class="ruby">          case order</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="80">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">          when Symbol, String</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            

            
              
            

            <code class="ruby">            order.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="82">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">          when Array</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            

            
              
            

            <code class="ruby">            order.map(&amp;:to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="84">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">          when Hash</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            

            
              
            

            <code class="ruby">            order.transform_values(&amp;:to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="86">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            

            
              
            

            <code class="ruby">            raise ArgumentError, &#39;Invalid order format&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4aa24b7c0b1325866ea406e0940f109e54442380">
  <div class="header">
    <h3>lib/type_balancer/rails/query/pagination_service.rb</h3>
    <h4>
      <span class="red">
  51.11%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>45</b> relevant lines.
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>22</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>6</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Query</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Handles pagination for balanced collections with support for multiple pagination libraries</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class PaginationService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        DEFAULT_PAGE = 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        DEFAULT_PER_PAGE = 25</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        MAX_PER_PAGE = 100</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize(collection, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">          @collection = collection</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            
              
            

            <code class="ruby">          @options = options</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">          @page = (options[:page] || DEFAULT_PAGE).to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">          @per_page = [(options[:per_page] || DEFAULT_PER_PAGE).to_i, MAX_PER_PAGE].min</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def paginate</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="20">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          return collection if skip_pagination?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="22">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          if kaminari_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="23">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">            paginate_with_kaminari</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="24">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          elsif will_paginate_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">            paginate_with_will_paginate</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="26">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            

            
              
            

            <code class="ruby">            manual_pagination</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def next_page?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            

            
              
            

            <code class="ruby">          total_count &gt; (page * per_page)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def prev_page?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            

            
              
            

            <code class="ruby">          page &gt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def total_pages</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            

            
              
            

            <code class="ruby">          (total_count.to_f / per_page).ceil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def current_page</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            

            
              
            

            <code class="ruby">          page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :collection, :options, :page, :per_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def skip_pagination?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            

            
              
            

            <code class="ruby">          options[:paginate] == false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def kaminari_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            

            
              
            

            <code class="ruby">          defined?(Kaminari) &amp;&amp; collection.respond_to?(:page)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def will_paginate_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            

            
              
            

            <code class="ruby">          defined?(WillPaginate::Collection) &amp;&amp; collection.respond_to?(:paginate)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="63">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def paginate_with_kaminari</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            

            
              
            

            <code class="ruby">          collection.page(page).per(per_page)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def paginate_with_will_paginate</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            

            
              
            

            <code class="ruby">          collection.paginate(page: page, per_page: per_page)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="71">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def manual_pagination</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            

            
              
            

            <code class="ruby">          collection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">            .offset(offset)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">            .limit(per_page)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="77">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def offset</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            

            
              
            

            <code class="ruby">          (page - 1) * per_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def total_count</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            

            
              
            

            <code class="ruby">          @total_count ||= collection.count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a9cbcce008672036bcf2f5c0bd4ec249aeb2d97a">
  <div class="header">
    <h3>lib/type_balancer/rails/query/position_manager.rb</h3>
    <h4>
      <span class="red">
  33.33%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>51</b> relevant lines.
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>34</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>15</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>15</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Query</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Manages position calculation and storage for balanced collections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class PositionManager</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize(scope, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">          @scope = scope</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">          @options = options</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">          @storage = options.fetch(:storage) { default_storage }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            

            
              
            

            <code class="ruby">          @type_field = options[:type_field]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def calculate_positions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">          validate_scope!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            
              
            

            <code class="ruby">          TypeBalancer.calculate_positions(collection: scope, options: options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def store_positions(positions)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">          positions.each_with_index do |record, index|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">            storage.store(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">              record_id: record.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">              record_type: record.class.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">              position: index + 1,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">              type_field: type_field,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">              type_value: record.public_send(type_field)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">            )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def fetch_positions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            

            
              
            

            <code class="ruby">          storage.fetch_for_scope(scope)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def clear_positions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            

            
              
            

            <code class="ruby">          storage.clear_for_scope(scope)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :scope, :options, :storage, :type_field</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def validate_scope!</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="45">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;Scope cannot be nil&#39; if scope.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="46">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;Scope must be an ActiveRecord::Relation&#39; unless scope.is_a?(ActiveRecord::Relation)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="47">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;Type field must be specified&#39; unless type_field</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def group_and_calculate</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            

            
              
            

            <code class="ruby">          records_by_type = scope.group_by { |record| record.public_send(type_field) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            

            
              
            

            <code class="ruby">          balance_groups(records_by_type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def balance_groups(records_by_type)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            

            
              
            

            <code class="ruby">          types = determine_type_order(records_by_type.keys)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            

            
              
            

            <code class="ruby">          balanced_records = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            

            
              
            

            <code class="ruby">          max_per_type = calculate_max_per_type(records_by_type)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            

            
              
            

            <code class="ruby">          current_indexes = Hash.new(0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="62">
            

            
              
                <span class="hits" title="body branch hit 0 times">
                  body: 0
                </span>
              
            

            <code class="ruby">          until balanced_records.length == scope.count</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            

            
              
            

            <code class="ruby">            types.each do |type|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            

            
              
            

            <code class="ruby">              records = records_by_type[type] || []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            

            
              
            

            <code class="ruby">              index = current_indexes[type]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="67">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">              if index &lt; records.length &amp;&amp; index &lt; max_per_type</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            

            
              
            

            <code class="ruby">                balanced_records &lt;&lt; records[index]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            

            
              
            

            <code class="ruby">                current_indexes[type] += 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">              end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            

            
              
            

            <code class="ruby">          balanced_records</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="77">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def determine_type_order(available_types)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="78">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          return options[:order] if options[:order].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="79">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          return available_types.sort if options[:order_alphabetically]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            

            
              
            

            <code class="ruby">          available_types</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="84">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def calculate_max_per_type(records_by_type)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            

            
              
            

            <code class="ruby">          counts = records_by_type.values.map(&amp;:length)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="86">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          return 0 if counts.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            

            
              
            

            <code class="ruby">          counts.max</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="91">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def default_storage</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            

            
              
            

            <code class="ruby">          TypeBalancer::Rails::Strategies::CursorStrategy.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="975c619efbc7c3a78fcb79e80ea2e8473a531f7b">
  <div class="header">
    <h3>lib/type_balancer/rails/railtie.rb</h3>
    <h4>
      <span class="red">
  33.33%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>12</b> relevant lines.
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    class Railtie &lt; ::Rails::Railtie</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      initializer &#39;type_balancer.configure_rails_initialization&#39; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="7">
            

            
              
            

            <code class="ruby">        TypeBalancer::Rails.configure do |config|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">          # Register default strategies</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">          config.register_strategy(:cursor, TypeBalancer::Rails::Strategies::CursorStrategy)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">          config.register_strategy(:redis, TypeBalancer::Rails::Strategies::RedisStrategy)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">          # Set default strategy</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">          config.storage_strategy = :cursor</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">          # Configure cache settings</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">          config.cache_enabled = true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            
              
            

            <code class="ruby">          config.cache_ttl = 3600 # 1 hour default</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">        # Include the ActiveRecord extension</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">        ActiveSupport.on_load(:active_record) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">          include TypeBalancer::Rails::ActiveRecordExtension</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="04fec1c9149d946f7a7afdc61f054533003f0b78">
  <div class="header">
    <h3>lib/type_balancer/rails/storage.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>7</b> relevant lines.
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;storage/base_storage&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;storage/cache_decorator&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;storage/cursor_storage&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;storage/redis_storage&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Storage</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9c12dc1be6485d0f97f072f2117c65806623218c">
  <div class="header">
    <h3>lib/type_balancer/rails/storage/base_storage.rb</h3>
    <h4>
      <span class="red">
  53.85%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>26</b> relevant lines.
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>12</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>14</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>14</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Storage</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Base class defining the interface for all storage strategies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class BaseStorage</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">          @options = options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">        # Store a value with an optional TTL</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">        # @param key [String, Symbol] The key to store the value under</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">        # @param value [Object] The value to store</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">        # @param ttl [Integer, nil] Optional TTL in seconds</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">        # @raise [ArgumentError] If key or value is invalid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def store(key, value, ttl = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">          raise NotImplementedError, &quot;#{self.class} must implement #store&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">        # Fetch a value by key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">        # @param key [String, Symbol] The key to fetch</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">        # @return [Object, nil] The stored value or nil if not found</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">        # @raise [ArgumentError] If key is invalid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def fetch(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">          raise NotImplementedError, &quot;#{self.class} must implement #fetch&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">        # Delete a value by key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">        # @param key [String, Symbol] The key to delete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">        # @raise [ArgumentError] If key is invalid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def delete(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            

            
              
            

            <code class="ruby">          raise NotImplementedError, &quot;#{self.class} must implement #delete&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        # Clear all stored values</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def clear</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            

            
              
            

            <code class="ruby">          raise NotImplementedError, &quot;#{self.class} must implement #clear&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def validate_key!(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="46">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;Key cannot be nil&#39; if key.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="47">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;Key must be a string or symbol&#39; unless key.is_a?(String) || key.is_a?(Symbol)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="48">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;Key cannot be empty&#39; if key.to_s.strip.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def validate_value!(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="52">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;Value cannot be nil&#39; if value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="53">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;Value must respond to to_json&#39; unless value.respond_to?(:to_json)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def validate_ttl!(ttl)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="57">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          return if ttl.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="58">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;TTL must be a non-negative integer&#39; unless ttl.is_a?(Integer) &amp;&amp; ttl &gt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="54c74bd733bdece15031694ad83bc14d6848d928">
  <div class="header">
    <h3>lib/type_balancer/rails/storage/cache_decorator.rb</h3>
    <h4>
      <span class="red">
  46.43%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>28</b> relevant lines.
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>15</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>8</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Storage</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Decorator that adds caching capabilities to storage strategies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class CacheDecorator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize(storage)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">          @storage = storage</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">          @cache_store = ::Rails.cache</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def store(key, value, ttl = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            
              
            

            <code class="ruby">          storage.store(key, value, ttl)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="15">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          cache_store.write(cache_key(key), value, expires_in: ttl) if cache_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">          value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def fetch(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="20">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          if cache_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">            cache_store.fetch(cache_key(key)) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">              storage.fetch(key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="24">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">            storage.fetch(key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def delete(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">          storage.delete(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="31">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          cache_store.delete(cache_key(key)) if cache_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def clear</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            

            
              
            

            <code class="ruby">          storage.clear</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="36">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          cache_store.clear if cache_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :storage, :cache_store</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def cache_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            

            
              
            

            <code class="ruby">          TypeBalancer::Rails.configuration.cache_enabled</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def cache_key(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            

            
              
            

            <code class="ruby">          &quot;type_balancer/#{storage.class.name.demodulize.underscore}/#{key}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4e497c16e17d52d85a03f248129f6b625c93ed62">
  <div class="header">
    <h3>lib/type_balancer/rails/storage/cursor_storage.rb</h3>
    <h4>
      <span class="red">
  26.83%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>41</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>30</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>4</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Storage</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Cursor-based storage implementation using memory</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class CursorStorage &lt; BaseStorage</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">          super</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">          @store = {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">          @ttl_store = {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            

            
              
            

            <code class="ruby">          @mutex = Mutex.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def store(key, value, ttl = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">          validate_key!(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            
              
            

            <code class="ruby">          validate_value!(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="18">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          validate_ttl!(ttl) if ttl</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">          @mutex.synchronize do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">            @store[key.to_s] = value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="23">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">            if ttl</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            

            
              
            

            <code class="ruby">              expiry_time = Time.now.to_i + ttl</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">              @ttl_store[key.to_s] = expiry_time</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            

            
              
            

            <code class="ruby">            cleanup_expired_keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            

            
              
            

            <code class="ruby">          value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def fetch(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            

            
              
            

            <code class="ruby">          validate_key!(key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            

            
              
            

            <code class="ruby">          @mutex.synchronize do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            

            
              
            

            <code class="ruby">            cleanup_expired_keys</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            

            
              
            

            <code class="ruby">            @store[key.to_s]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def delete(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            

            
              
            

            <code class="ruby">          validate_key!(key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            

            
              
            

            <code class="ruby">          @mutex.synchronize do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            

            
              
            

            <code class="ruby">            @store.delete(key.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            

            
              
            

            <code class="ruby">            @ttl_store.delete(key.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def clear</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            

            
              
            

            <code class="ruby">          @mutex.synchronize do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            

            
              
            

            <code class="ruby">            @store.clear</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            

            
              
            

            <code class="ruby">            @ttl_store.clear</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def cleanup_expired_keys</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            

            
              
            

            <code class="ruby">          current_time = Time.now.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            

            
              
            

            <code class="ruby">          expired_keys = @ttl_store.select { |_, expiry| expiry &lt;= current_time }.keys</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            

            
              
            

            <code class="ruby">          expired_keys.each do |key|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            

            
              
            

            <code class="ruby">            @store.delete(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            

            
              
            

            <code class="ruby">            @ttl_store.delete(key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="08a37b119094a765949a0ce55e6dbdb1c8ab8ce9">
  <div class="header">
    <h3>lib/type_balancer/rails/storage/redis_storage.rb</h3>
    <h4>
      <span class="red">
  38.46%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>39</b> relevant lines.
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>24</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>10</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>10</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Storage</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Redis-based storage implementation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class RedisStorage &lt; BaseStorage</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">          super</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">          @redis = options[:redis] || TypeBalancer::Rails.configuration.redis_client</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="11">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;Redis client not configured&#39; unless @redis</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def store(key, value, ttl = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">          validate_key!(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">          validate_value!(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="17">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          validate_ttl!(ttl) if ttl</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">          serialized_value = serialize(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="20">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          if ttl</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">            redis.setex(storage_key(key), ttl, serialized_value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="22">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            
              
            

            <code class="ruby">            redis.set(storage_key(key), serialized_value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">          value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def fetch(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">          validate_key!(key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            

            
              
            

            <code class="ruby">          serialized_value = redis.get(storage_key(key))</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="33">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          return nil unless serialized_value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            

            
              
            

            <code class="ruby">          deserialize(serialized_value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def delete(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            

            
              
            

            <code class="ruby">          validate_key!(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            

            
              
            

            <code class="ruby">          redis.del(storage_key(key))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def clear</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            

            
              
            

            <code class="ruby">          keys = redis.keys(&quot;#{key_prefix}*&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="45">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          redis.del(*keys) unless keys.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :redis</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def key_prefix</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            

            
              
            

            <code class="ruby">          &#39;type_balancer:rails:&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def storage_key(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            

            
              
            

            <code class="ruby">          &quot;#{key_prefix}#{key}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="60">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def serialize(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            

            
              
            

            <code class="ruby">          Marshal.dump(value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def deserialize(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            

            
              
            

            <code class="ruby">          Marshal.load(value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">        rescue StandardError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            

            
              
            

            <code class="ruby">          nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="20ae1c430adfed18ddf0561ca5ee7705cd49a6a2">
  <div class="header">
    <h3>lib/type_balancer/rails/storage_strategies.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;strategies/base_strategy&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;strategies/redis_strategy&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;strategies/storage_strategy_registry&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require_relative &#39;strategies/storage_adapter&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    # Module containing all storage strategies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Strategies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      extend ActiveSupport::Autoload</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="65c4a4bad2349d52d5111ecebc4f1508ed48b030">
  <div class="header">
    <h3>lib/type_balancer/rails/strategies/base_strategy.rb</h3>
    <h4>
      <span class="red">
  54.05%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>37</b> relevant lines.
      <span class="green"><b>20</b> lines covered</span> and
      <span class="red"><b>17</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>6</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Strategies</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Base class for all storage strategies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class BaseStrategy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :collection, :options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize(collection = nil, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">          @collection = collection</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            

            
              
            

            <code class="ruby">          @options = options</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">          @cache_enabled = TypeBalancer::Rails.configuration.cache_enabled</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            
              
            

            <code class="ruby">          @cache_ttl = TypeBalancer::Rails.configuration.cache_ttl</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def execute</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">          raise NotImplementedError, &quot;#{self.class} must implement #execute&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def store(key, value, ttl = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">          raise NotImplementedError, &quot;#{self.class} must implement #store&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def fetch(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">          raise NotImplementedError, &quot;#{self.class} must implement #fetch&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def delete(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">          raise NotImplementedError, &quot;#{self.class} must implement #delete&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def clear</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            

            
              
            

            <code class="ruby">          raise NotImplementedError, &quot;#{self.class} must implement #clear&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def clear_for_scope(scope)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            

            
              
            

            <code class="ruby">          raise NotImplementedError, &quot;#{self.class} must implement #clear_for_scope&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def fetch_for_scope(scope)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            

            
              
            

            <code class="ruby">          raise NotImplementedError, &quot;#{self.class} must implement #fetch_for_scope&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def cache_key(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            

            
              
            

            <code class="ruby">          &quot;type_balancer:#{collection.object_id}:#{key}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def cache_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            

            
              
            

            <code class="ruby">          @cache_enabled</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :cache_ttl</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def normalize_ttl(ttl)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            

            
              
            

            <code class="ruby">          ttl || cache_ttl</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def validate_key!(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="62">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;Key cannot be nil&#39; if key.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="63">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;Key must be a string or symbol&#39; unless key.is_a?(String) || key.is_a?(Symbol)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="66">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def validate_value!(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="67">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          raise ArgumentError, &#39;Value cannot be nil&#39; if value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2814ab5e5082d3e81e856a5b4e9af3f805ffeea7">
  <div class="header">
    <h3>lib/type_balancer/rails/strategies/redis_strategy.rb</h3>
    <h4>
      <span class="red">
  30.19%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>53</b> relevant lines.
      <span class="green"><b>16</b> lines covered</span> and
      <span class="red"><b>37</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>14</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>14</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require &#39;json&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Strategies</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">      # Redis-based storage strategy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class RedisStrategy &lt; BaseStrategy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize(collection = nil, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">          super</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            

            
              
            

            <code class="ruby">          @redis = options[:redis] || TypeBalancer::Rails.configuration.redis_client</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="13">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          unless @redis &amp;&amp; TypeBalancer::Rails.configuration.redis_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            
              
            

            <code class="ruby">            raise ArgumentError,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">                  &#39;Redis client not configured&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">          @default_ttl = options[:ttl] || TypeBalancer::Rails.configuration.redis_ttl</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def store(key, value, ttl = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">          validate_key!(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            
              
            

            <code class="ruby">          validate_value!(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            

            
              
            

            <code class="ruby">          key = cache_key(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">          ttl ||= @default_ttl</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="27">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          if ttl &amp;&amp; ttl &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            

            
              
            

            <code class="ruby">            @redis.setex(key, ttl.to_i, value.to_json)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="29">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">            @redis.set(key, value.to_json)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def fetch(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            

            
              
            

            <code class="ruby">          validate_key!(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            

            
              
            

            <code class="ruby">          key = cache_key(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            

            
              
            

            <code class="ruby">          value = @redis.get(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="38">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          return nil unless value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">          begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            

            
              
            

            <code class="ruby">            JSON.parse(value, symbolize_names: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            

            
              
            

            <code class="ruby">          rescue JSON::ParserError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            

            
              
            

            <code class="ruby">            nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def delete(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            

            
              
            

            <code class="ruby">          validate_key!(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            

            
              
            

            <code class="ruby">          @redis.del(cache_key(key))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def clear</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            

            
              
            

            <code class="ruby">          pattern = cache_pattern</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            

            
              
            

            <code class="ruby">          keys = @redis.keys(pattern)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="55">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          @redis.del(*keys) if keys.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def clear_for_scope(scope)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            

            
              
            

            <code class="ruby">          pattern = cache_pattern_for_scope(scope)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            

            
              
            

            <code class="ruby">          keys = @redis.keys(pattern)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="61">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          @redis.del(*keys) if keys.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def fetch_for_scope(scope)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            

            
              
            

            <code class="ruby">          pattern = cache_pattern_for_scope(scope)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            

            
              
            

            <code class="ruby">          keys = @redis.keys(pattern)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="67">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          return {} if keys.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            

            
              
            

            <code class="ruby">          keys.each_with_object({}) do |key, result|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            

            
              
            

            <code class="ruby">            value = @redis.get(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="71">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">            next unless value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">            begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            

            
              
            

            <code class="ruby">              result[key] = JSON.parse(value, symbolize_names: true)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">            rescue JSON::ParserError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            

            
              
            

            <code class="ruby">              next</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="83">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :redis</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="85">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def cache_pattern</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            

            
              
            

            <code class="ruby">          &quot;type_balancer:#{@collection.object_id}:*&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="89">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def cache_pattern_for_scope(scope)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            

            
              
            

            <code class="ruby">          &quot;type_balancer:#{scope.object_id}:*&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="e8bb0073eea3ec94587ab9cbe7658cb59bfdc013">
  <div class="header">
    <h3>lib/type_balancer/rails/strategies/storage_adapter.rb</h3>
    <h4>
      <span class="red">
  48.15%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>27</b> relevant lines.
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>14</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>4</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Strategies</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Adapter for storage strategies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class StorageAdapter</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize(strategy_manager)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">          @strategy_manager = strategy_manager</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">          @adapter = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_accessor :adapter</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        attr_reader :strategy_manager</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def configure_redis(client = nil, &amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="17">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">            yield(redis_client)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="19">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">            @redis_client = client</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def configure_cache(store = nil, &amp;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="25">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">            yield(cache_store)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="27">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            

            
              
            

            <code class="ruby">            @cache_store = store</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def redis_client</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            

            
              
            

            <code class="ruby">          @redis_client ||= ::Redis.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def cache_store</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            

            
              
            

            <code class="ruby">          @cache_store ||= ::Rails.cache</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def redis_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            

            
              
            

            <code class="ruby">          !redis_client.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def reset!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            

            
              
            

            <code class="ruby">          @redis_client = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            

            
              
            

            <code class="ruby">          @cache_store = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            

            
              
            

            <code class="ruby">          @adapter = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d8c16f999a9abdab0b45548cd4c20c0883f9d01e">
  <div class="header">
    <h3>lib/type_balancer/rails/strategies/storage_strategy_registry.rb</h3>
    <h4>
      <span class="red">
  56.25%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>16</b> relevant lines.
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module TypeBalancer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  module Rails</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    module Strategies</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Registry for storage strategies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      class StorageStrategyRegistry</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">          @strategies = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def register(name, strategy)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">          @strategies[name.to_sym] = strategy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def resolve(name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            
              
            

            <code class="ruby">          strategy = @strategies[name.to_sym]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="18">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          raise KeyError, &quot;Unknown storage strategy: #{name}&quot; unless strategy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">          strategy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def registered_strategies</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            

            
              
            

            <code class="ruby">          @strategies.keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        def reset!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            

            
              
            

            <code class="ruby">          @strategies = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
